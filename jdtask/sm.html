<!DOCTYPE HTML>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <title>京东答题</title>
    <style type="text/css">

        .visited {
            color: gray;
        }

    </style>
</head>

<body>
    <div id="main">

    </div>
    <script src="https://cdn.bootcss.com/jquery/2.2.2/jquery.min.js"></script>
    <script>
        var clickedUrl = localStorage.getItem("smJdClickUrl");
        if(clickedUrl) {
            clickedUrl = JSON.parse(clickedUrl);            
        } else {
            clickedUrl = [];
        }        
        $("#main").html("loading...<br />" + localStorage.getItem("smJdHtml"));
        setClicked();
        $.get("https://getpage.now.sh/?url=https%3A%2F%2Fshimo.im%2Fdocs%2Fb4LMFBapNUMp07ym%2Fread", r => {
            //console.info(r);
            var txt = $(r).find(".ql-editor").html();
            localStorage.setItem("smJdHtml", txt);
            $("#main").html(txt);
            setClicked();
        });
        $(document.body).on("click", "a.ql-link", e => {
            var href = e.target.href;
            if(clickedUrl.indexOf(href)==-1) {
                e.target.className = "ql-link visited";
                clickedUrl.push(href);
                if(clickedUrl.length>50) clickedUrl.pop();
                localStorage.setItem("smJdClickUrl",JSON.stringify(clickedUrl));
            }
        });

        function setClicked() {
            var $a = $("a.ql-link");
            for (let index = 0; index < 100; index++) {
                var a = $a[index];
                if(clickedUrl.indexOf(a.href)>=0) {
                    a.className = "ql-link visited";
                }                
            }
        }
    </script>
</body>

</html>